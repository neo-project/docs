# コントラクト認証チュートリアル

このチュートリアルはVisual Studio 2017に基づいています。Visual Studioが2017バージョンにアップグレードされていることを確認してください。さらに、このチュートリアルはSmart Contract 2.0のデモに基づいており、[GitHub](https://github.com/AntShares/AntSharesCore/releases)から**テストネットワーク**をダウンロードして実行してください。

このドキュメントを作成する時点で、最新の**テストネットワーク**クライアント（AntSharesCore-GUI-v2.0.6390.29136）を[ダウンロード](https://github.com/AntShares/AntSharesCore/releases/download/v2.0.0-preview2-04/AntSharesCore-GUI-v2.0.6390.29136.zip)して下さい。

## コントラクトスクリプトをコンパイル

```c#
using NEO.SmartContract.Framework;
using NEO.SmartContract.Framework.Services.NEO;
using NEO.SmartContract.Framework.Services.System;
namespace NEO.SmartContract
{
    public class Test : VerificationCode
    {
        public static bool Verify(byte[] signature)
        {
            return true;
        }
    }
}
```

> [!注意]　
> スマートコントラクトスクリプトを作成して生成する方法がわからない場合は、[C#を使用してAntSharesスマートコントラクトを作成する方法] (../getting-started.md) を参照してください。
>

上記のコントラクトはTest.avmにコンパイルされ、コントラクトスクリプト（Test.avmバイナリデータ）は次のようになります：52c56b6c766b00527ac461516c766b51527ac46203006c766b51c3616c7566

このチュートリアルの後半で.avmファイルのコントラクトスクリプトを取得する方法を学習します。

## ウォレットを作成する

次のチュートリアルに従って新しいウォレットを作成します。

![ウォレットを作成する](~/images/w1.jpeg)

## コントラクトスクリプトの入手

コントラクトスクリプトを入手するには多くの方法がありますが、1つの方法は以下のC#コードを使用して.avmファイルから直接読み取る方法です。

```c#
byte [] bytes = System.IO.File.ReadAllBytes（ "Test.avm"）;
string str = System.Text.Encoding.Default.GetString（bytes）;
```

コーディングによってコントラクトスクリプトを取得したくない場合、クライアントの「デプロイメントコントラクト」はコントラクトコードを取得する簡単な方法を提供します。

クライアントのPC版では、 "Advanced" - "Deploy Contract ..."をクリックし、右下隅にある "Load"をクリックし、Test.avmファイルを選択します。 [コード]ボックスには、下図のようなコントラクトスクリプトが表示されます。後の手順で使用されるように、コードスクリプトをコピーします。

![コントラクトスクリプトの入手](~/images/2017-07-06_11-43-46.png)

## コントラクトアドレスを作成する

独自のウォレットを作成したら、マウスの右ボタンをクリックし、生成されたコントラクトスクリプトを使用してコントラクトアドレスを作成します。

![コントラクトアドレスを作成する](~/images/w2.jpeg)

コントラクトアドレスをアカウントに関連付けし、対応するパラメータを入力します。コントラクトには署名のパラメータがあるため、「パラメータリスト」に「00」を記入し（詳細はこの[文書](Parameter.md)を参照してください）、前のステップのコントラクトスクリプトを「コード」ボックスに入力する必要があります。

アカウントを関連付ける理由は、コントラクトを公開鍵と秘密鍵のペアで関連付けするため、コントラクトに署名する必要がある場合、クライアントは自動的に関連付けされたアカウントの秘密鍵で署名します。

![コントラクトアドレスを作成する](~/images/w3.jpeg)

[OK]をクリックすると、スマートコントラクト認証アカウントが正常に作成されます。

## テスト

以下はスマートコントラクト認証アカウントのテストです。スマートコントラクト認証アカウントが資産を転送してからコンセンサスノードがスマートコントラクトを検証して実行するまでのプロセスです。コントラクトの検証が成功した場合（結果「true」を返す）、取引が確認されます。結果「真」が受信されるまで、トランザクションのステータスは未確認です。テスト方法は、最初に資産をコントラクト認証アカウントに転送してから展開することです。

> [!注意]　
> テストの正確さを保証するために、財布には他の資産はありません。それ以外の場合は、クライアントの変更検索アルゴリズムを理解し、トランザクションがスマートコントラクトアドレスから転送されたことを確認できない限り、資産が標準勘定から転送されたのか、コントラクト勘定から転送されたのかを知ることができません。
アセットをコントラクト住所に転送する

### 設定された金額の資産をコントラクトアカウントに転送する

アセットをコントラクト住所に転送する；

![設定された金額の資産をコントラクトアカウントに転送する](~/images/w4.jpeg)

### コントラクト資産を移転する

スマートコントラクトアカウントからアセットを転送する：

![コントラクト資産を移転する](~/images/w5.jpeg)

> [!注意]　
> クライアントの資産残高は、標準勘定の残高とコントラクト住所の残高の合計、つまりすべての住所の資産を合計したものです。コントラクトアドレスで資産を使用するかどうかは、スマートコントラクトの実行結果によって異なります。コントラクトが成功した場合（結果が真である場合）、資産は転送され、そうでない場合は転送できません。
